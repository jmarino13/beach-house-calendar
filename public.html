<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beach House Calendar - Public View</title>

  <!-- FullCalendar -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background:#0b1220;
      color:#eaf0ff;
    }

    header {
      padding: 16px 18px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px;
    }

    .card {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 14px;
    }

    #calendar {
      margin-top: 14px;
      min-height: 520px;
    }

    .muted {
      opacity:.8;
      font-size: 13px;
    }
  </style>
</head>

<body>

<header>
  <div>
    <div style="font-weight:700;">Beach House Calendar</div>
    <div class="muted">Public Availability View</div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <div id="calendar"></div>
  </div>
</div>

<script>

  const SUPABASE_URL = "https://acbskcpmpxwnixwmbyfc.supabase.co";
  const SUPABASE_KEY = "YOUR_ANON_KEY_HERE"; // same anon key as index.html

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  function toISODate(d) {
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }

  function addDaysISO(iso, days) {
    const d = new Date(iso+"T00:00:00");
    d.setDate(d.getDate()+days);
    return toISODate(d);
  }

  async function loadPublicBlocks() {
    const { data, error } = await sb
      .from("blocks")
      .select("id,start_date,end_date,owner_name,notes")
      .order("start_date", { ascending: true });

    if (error) {
      console.error(error);
      return [];
    }

    return (data || []).map(b => ({
      id: b.id,
      title: b.owner_name,
      start: b.start_date,
      end: addDaysISO(b.end_date,1),
      allDay: true
    }));
  }

  async function initCalendar() {

    const events = await loadPublicBlocks();

    const calendar = new FullCalendar.Calendar(
      document.getElementById("calendar"),
      {
        initialView: window.innerWidth < 700 ? "dayGridWeek" : "dayGridMonth",
        height: "auto",
        expandRows: true,
        events
      }
    );

    calendar.render();
  }

  initCalendar();

</script>

</body>
</html>
